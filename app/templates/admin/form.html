{% extends "base.html" %}

{% block title %}{{ action }} System - Admin{% endblock %}

{% block styles %}
.form-container {
    max-width: 800px;
    margin: 2rem auto;
    background: white;
    padding: 2rem;
    border-radius: 4px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.form-header {
    margin-bottom: 2rem;
}

.form-header h2 {
    color: #2c3e50;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: #2c3e50;
}

.form-group input,
.form-group select {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 1rem;
}

.form-group input:focus,
.form-group select:focus {
    outline: none;
    border-color: #3498db;
}

.form-group small {
    display: block;
    margin-top: 0.25rem;
    color: #7f8c8d;
    font-size: 0.85rem;
}

.checkbox-group {
    display: flex;
    align-items: center;
}

.checkbox-group input {
    width: auto;
    margin-right: 0.5rem;
}

.form-actions {
    display: flex;
    gap: 1rem;
    margin-top: 2rem;
}

.btn {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 1rem;
    text-decoration: none;
    display: inline-block;
    transition: all 0.3s;
}

.btn-primary {
    background: #3498db;
    color: white;
}

.btn-primary:hover {
    background: #2980b9;
}

.btn-secondary {
    background: #95a5a6;
    color: white;
}

.btn-secondary:hover {
    background: #7f8c8d;
}

.credential-section {
    background: #f8f9fa;
    padding: 1.5rem;
    border-radius: 4px;
    margin: 1rem 0;
}

.credential-section h3 {
    margin-bottom: 1rem;
    color: #2c3e50;
    font-size: 1.1rem;
}
{% endblock %}

{% block content %}
<div class="form-container">
    <div class="form-header">
        <h2>{{ action }} Storage System</h2>
    </div>
    
    <form method="POST">
        <div class="form-group">
            <label for="name">Name *</label>
            <input type="text" id="name" name="name" required 
                   value="{{ system.name if system else '' }}">
            <small>Eindeutiger Name für das Storage System</small>
        </div>
        
        <div class="form-group">
            <label for="vendor">Hersteller / Typ *</label>
            <select id="vendor" name="vendor" required>
                <option value="">-- Bitte wählen --</option>
                <option value="pure" {{ 'selected' if system and system.vendor == 'pure' else '' }}>
                    Pure Storage
                </option>
                <option value="netapp-ontap" {{ 'selected' if system and system.vendor == 'netapp-ontap' else '' }}>
                    NetApp ONTAP 9
                </option>
                <option value="netapp-storagegrid" {{ 'selected' if system and system.vendor == 'netapp-storagegrid' else '' }}>
                    NetApp StorageGRID 11
                </option>
                <option value="dell-datadomain" {{ 'selected' if system and system.vendor == 'dell-datadomain' else '' }}>
                    Dell DataDomain
                </option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="ip_address">IP Adresse / Hostname *</label>
            <input type="text" id="ip_address" name="ip_address" required 
                   value="{{ system.ip_address if system else '' }}">
        </div>
        
        <div class="form-group">
            <label for="port">Port</label>
            <input type="number" id="port" name="port" value="{{ system.port if system else 443 }}">
            <small>Standard: 443</small>
        </div>
        
        <div class="form-group">
            <label for="cluster_type">Cluster-Typ (optional)</label>
            <select id="cluster_type" name="cluster_type">
                <option value="">-- Nicht angegeben --</option>
                <optgroup label="Pure Storage">
                    <option value="ha" {{ 'selected' if system and system.cluster_type == 'ha' else '' }}>HA Cluster</option>
                    <option value="active-cluster" {{ 'selected' if system and system.cluster_type == 'active-cluster' else '' }}>Active Cluster</option>
                </optgroup>
                <optgroup label="NetApp ONTAP">
                    <option value="local" {{ 'selected' if system and system.cluster_type == 'local' else '' }}>Local Cluster</option>
                    <option value="metrocluster" {{ 'selected' if system and system.cluster_type == 'metrocluster' else '' }}>MetroCluster</option>
                </optgroup>
                <optgroup label="StorageGRID">
                    <option value="single-site" {{ 'selected' if system and system.cluster_type == 'single-site' else '' }}>Single Site</option>
                    <option value="multi-site" {{ 'selected' if system and system.cluster_type == 'multi-site' else '' }}>Multi-Site</option>
                </optgroup>
            </select>
            <small>Cluster-Architektur des Systems</small>
        </div>
        
        <div class="form-group" id="node-fields" style="display: none;">
            <label for="node_count">Anzahl Nodes (optional)</label>
            <input type="number" id="node_count" name="node_count" min="1" 
                   value="{{ system.node_count if system else '' }}">
            <small>Anzahl der Nodes im Cluster (v.a. für StorageGRID)</small>
        </div>
        
        <div class="form-group" id="site-fields" style="display: none;">
            <label for="site_count">Anzahl Sites (optional)</label>
            <input type="number" id="site_count" name="site_count" min="1" 
                   value="{{ system.site_count if system else '' }}">
            <small>Anzahl der Sites (v.a. für StorageGRID Multi-Site)</small>
        </div>
        
        <script>
            // Show/hide node and site fields based on cluster type
            document.getElementById('cluster_type').addEventListener('change', function() {
                const nodeFields = document.getElementById('node-fields');
                const siteFields = document.getElementById('site-fields');
                const clusterType = this.value;
                
                if (clusterType === 'single-site' || clusterType === 'multi-site') {
                    nodeFields.style.display = 'block';
                } else {
                    nodeFields.style.display = 'none';
                }
                
                if (clusterType === 'multi-site') {
                    siteFields.style.display = 'block';
                } else {
                    siteFields.style.display = 'none';
                }
            });
            
            // Trigger on page load
            document.getElementById('cluster_type').dispatchEvent(new Event('change'));
        </script>
        
        <div class="credential-section">
            <h3>API Zugangsdaten</h3>
            
            <div class="form-group">
                <label for="api_username">Benutzername</label>
                <input type="text" id="api_username" name="api_username" 
                       value="{{ system.api_username if system else '' }}">
                <small>Für NetApp ONTAP und Dell DataDomain</small>
            </div>
            
            <div class="form-group">
                <label for="api_password">Passwort</label>
                <input type="password" id="api_password" name="api_password" 
                       value="{{ system.api_password if system else '' }}">
                <small>Für NetApp ONTAP und Dell DataDomain</small>
            </div>
            
            <div class="form-group">
                <label for="api_token">API Token</label>
                <input type="text" id="api_token" name="api_token" 
                       value="{{ system.api_token if system else '' }}">
                <small>Für Pure Storage und NetApp StorageGRID</small>
            </div>
        </div>
        
        <div class="form-group">
            <div class="checkbox-group">
                <input type="checkbox" id="enabled" name="enabled" 
                       {{ 'checked' if not system or system.enabled else '' }}>
                <label for="enabled" style="margin-bottom: 0;">System aktiviert</label>
            </div>
            <small>Deaktivierte Systeme werden nicht im Dashboard angezeigt</small>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Speichern</button>
            <a href="/admin" class="btn btn-secondary">Abbrechen</a>
        </div>
    </form>
</div>
{% endblock %}
