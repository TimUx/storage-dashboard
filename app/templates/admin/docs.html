{% extends "base.html" %}

{% block title %}API Dokumentation - Admin{% endblock %}

{% block styles %}
.docs-container {
    max-width: 900px;
    margin: 2rem auto;
    background: white;
    padding: 2rem;
    border-radius: 4px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.docs-container h2 {
    color: #2c3e50;
    margin-top: 2rem;
    margin-bottom: 1rem;
    border-bottom: 2px solid #3498db;
    padding-bottom: 0.5rem;
}

.docs-container h3 {
    color: #34495e;
    margin-top: 1.5rem;
    margin-bottom: 0.75rem;
}

.docs-container p {
    line-height: 1.6;
    margin-bottom: 1rem;
}

.docs-container ul, .docs-container ol {
    margin-left: 2rem;
    margin-bottom: 1rem;
    line-height: 1.8;
}

.docs-container code {
    background: #f8f9fa;
    padding: 0.2rem 0.4rem;
    border-radius: 3px;
    font-family: 'Courier New', monospace;
    color: #e74c3c;
}

.docs-container pre {
    background: #2c3e50;
    color: #ecf0f1;
    padding: 1rem;
    border-radius: 4px;
    overflow-x: auto;
    margin-bottom: 1rem;
}

.docs-container pre code {
    background: none;
    color: #ecf0f1;
    padding: 0;
}

.vendor-card {
    background: #f8f9fa;
    border-left: 4px solid #3498db;
    padding: 1.5rem;
    margin: 1rem 0;
    border-radius: 4px;
}

.vendor-card h4 {
    color: #2c3e50;
    margin-bottom: 0.75rem;
}

.note {
    background: #fff3cd;
    border-left: 4px solid #f39c12;
    padding: 1rem;
    margin: 1rem 0;
    border-radius: 4px;
}

.note strong {
    color: #856404;
}
{% endblock %}

{% block content %}
<div class="docs-container">
    <h1>API Einrichtungs-Dokumentation</h1>
    
    <p>Diese Anleitung beschreibt, wie Sie API-Zugriff f√ºr jedes unterst√ºtzte Storage-System einrichten.</p>
    
    <div class="note">
        <strong>üí° Verwendete Bibliotheken:</strong>
        <ul style="margin-top: 0.5rem;">
            <li><strong>Pure Storage:</strong> Offizielle <code>py-pure-client</code> SDK</li>
            <li><strong>NetApp ONTAP:</strong> Offizielle <code>netapp-ontap</code> SDK</li>
            <li><strong>StorageGRID & DataDomain:</strong> Direkte REST API Integration (keine offiziellen Python SDKs verf√ºgbar)</li>
        </ul>
    </div>
    
    <h2>1. Pure Storage</h2>
    
    <div class="vendor-card">
        <h4>API-Token erstellen</h4>
        <ol>
            <li>Melden Sie sich bei Ihrem Pure Storage FlashArray an</li>
            <li>Navigieren Sie zu <strong>System ‚Üí Users</strong></li>
            <li>W√§hlen Sie einen Benutzer aus oder erstellen Sie einen neuen</li>
            <li>Klicken Sie auf <strong>Create API Token</strong></li>
            <li>Kopieren Sie den generierten Token</li>
        </ol>
        
        <p><strong>In der Dashboard-Konfiguration:</strong></p>
        <ul>
            <li>Tragen Sie den Token im Feld <code>API Token</code> ein</li>
            <li>Lassen Sie Benutzername und Passwort leer</li>
        </ul>
    </div>
    
    <div class="note">
        <strong>Hinweis:</strong> Das Dashboard verwendet die offizielle <code>py-pure-client</code> Bibliothek f√ºr Pure Storage FlashArray REST API v2.
    </div>
    
    <h2>2. NetApp ONTAP 9</h2>
    
    <div class="vendor-card">
        <h4>API-Zugriff einrichten</h4>
        <ol>
            <li>Stellen Sie sicher, dass die ONTAP REST API aktiviert ist</li>
            <li>Erstellen Sie einen Benutzer mit entsprechenden Berechtigungen:
                <pre><code>security login create -user-or-group-name api_user -application http -authentication-method password -role readonly</code></pre>
            </li>
            <li>Setzen Sie ein Passwort f√ºr den Benutzer</li>
        </ol>
        
        <p><strong>In der Dashboard-Konfiguration:</strong></p>
        <ul>
            <li>Tragen Sie Benutzername im Feld <code>Benutzername</code> ein</li>
            <li>Tragen Sie Passwort im Feld <code>Passwort</code> ein</li>
            <li>Lassen Sie API Token leer</li>
        </ul>
    </div>
    
    <div class="note">
        <strong>Hinweis:</strong> Das Dashboard verwendet die offizielle <code>netapp-ontap</code> Python Client Library. F√ºr produktive Umgebungen sollte eine dedizierte Read-Only-Rolle verwendet werden.
    </div>
    
    <h2>3. NetApp StorageGRID 11</h2>
    
    <div class="vendor-card">
        <h4>API-Token erstellen</h4>
        
        <p><strong>Schritt 1: Grid Manager √∂ffnen</strong></p>
        <ul>
            <li>√ñffnen Sie Ihren Browser und navigieren Sie zu:<br>
                <code>https://&lt;storagegrid-ip-or-hostname&gt;</code></li>
            <li>Beispiel: <code>https://storagegrid.example.com</code> oder <code>https://192.168.1.100</code></li>
            <li>Melden Sie sich mit Ihren Zugangsdaten an</li>
        </ul>
        
        <p><strong>Schritt 2: API-Token generieren</strong></p>
        <ol>
            <li>Nach dem Login navigieren Sie zu <strong>Users</strong></li>
            <li>W√§hlen Sie Ihren Benutzer oder erstellen Sie einen Service-Account</li>
            <li>Klicken Sie auf <strong>Generate Token</strong></li>
            <li>Kopieren Sie den generierten Bearer Token</li>
            <li>Der Token wird nur einmal angezeigt - speichern Sie ihn sicher!</li>
        </ol>
        
        <div class="note">
            <strong>Alternative:</strong> Sie k√∂nnen den Token auch direkt √ºber die REST API erstellen:
            <pre style="margin-top: 0.5rem;"><code>curl -X POST "https://&lt;storagegrid-ip&gt;/api/v3/authorize" \
  -H "Content-Type: application/json" \
  -d '{
    "username": "root",
    "password": "your-password",
    "cookie": true,
    "csrfToken": false
  }' -k</code></pre>
        </div>
        
        <p><strong>Schritt 3: Token im Dashboard konfigurieren</strong></p>
        
        <p><strong>Option 1: Mit Bearer Token</strong></p>
        <ul>
            <li>Tragen Sie den Bearer Token im Feld <code>API Token</code> ein</li>
            <li>Lassen Sie Benutzername und Passwort leer</li>
        </ul>
        
        <p><strong>Option 2: Mit Benutzername/Passwort (empfohlen)</strong></p>
        <ul>
            <li>Tragen Sie Benutzername und Passwort ein</li>
            <li>Lassen Sie API Token leer</li>
            <li>Das Dashboard generiert automatisch Tokens bei Bedarf</li>
        </ul>
        
        <div class="note">
            <strong>Wichtige Hinweise:</strong>
            <ul style="margin-top: 0.5rem; margin-bottom: 0;">
                <li>Der Bearer Token hat eine begrenzte G√ºltigkeitsdauer (Standard: 16 Stunden)</li>
                <li>Bei Authentifizierungsfehlern muss ein neuer Token generiert werden</li>
                <li><strong>Empfehlung:</strong> Verwenden Sie Benutzername/Passwort statt Token - das Dashboard generiert dann automatisch neue Tokens bei Bedarf</li>
            </ul>
        </div>
    </div>
    
    <h2>4. Dell DataDomain</h2>
    
    <div class="vendor-card">
        <h4>REST API-Zugriff einrichten</h4>
        <ol>
            <li>Stellen Sie sicher, dass die REST API auf Ihrem DataDomain-System aktiviert ist</li>
            <li>Verwenden Sie einen vorhandenen Benutzer oder erstellen Sie einen neuen:
                <pre><code>user add &lt;username&gt; role admin</code></pre>
            </li>
            <li>Setzen Sie ein Passwort f√ºr den Benutzer</li>
        </ol>
        
        <p><strong>In der Dashboard-Konfiguration:</strong></p>
        <ul>
            <li>Tragen Sie Benutzername im Feld <code>Benutzername</code> ein</li>
            <li>Tragen Sie Passwort im Feld <code>Passwort</code> ein</li>
            <li>Lassen Sie API Token leer</li>
        </ul>
    </div>
    
    <div class="note">
        <strong>Hinweis:</strong> Die REST API ist standardm√§√üig auf Port 443 verf√ºgbar.
    </div>
    
    <h2>Sicherheitshinweise</h2>
    
    <ul>
        <li>Verwenden Sie immer dedizierte Read-Only-Accounts f√ºr das Dashboard</li>
        <li>Speichern Sie Credentials niemals in √∂ffentlich zug√§nglichen Repositories</li>
        <li>Rotieren Sie API-Tokens und Passw√∂rter regelm√§√üig</li>
        <li>Verwenden Sie sichere Verbindungen (HTTPS)</li>
        <li>Beschr√§nken Sie den Netzwerkzugriff auf die Management-Schnittstellen</li>
    </ul>
    
    <h2>Fehlerbehebung</h2>
    
    <h3>Verbindungsfehler</h3>
    <ul>
        <li>√úberpr√ºfen Sie die IP-Adresse und den Port</li>
        <li>Stellen Sie sicher, dass das Storage-System vom Dashboard-Server erreichbar ist</li>
        <li>√úberpr√ºfen Sie Firewall-Regeln</li>
    </ul>
    
    <h3>Authentifizierungsfehler</h3>
    <ul>
        <li>Verifizieren Sie Benutzername und Passwort</li>
        <li>√úberpr√ºfen Sie die G√ºltigkeit des API-Tokens</li>
        <li>Stellen Sie sicher, dass der Benutzer die notwendigen Berechtigungen hat</li>
    </ul>
    
    <h3>API-Fehler</h3>
    <ul>
        <li>√úberpr√ºfen Sie, ob die REST API auf dem Storage-System aktiviert ist</li>
        <li>Stellen Sie sicher, dass die API-Version kompatibel ist</li>
        <li>Pr√ºfen Sie die Logs f√ºr detaillierte Fehlermeldungen</li>
    </ul>
</div>
{% endblock %}
